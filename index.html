<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Error 1101</title>
<style>
  /* --- 1. è¿˜åŸæœ€æ—©ç‰ˆæœ¬çš„çœŸå®ä¼ªè£…é¡µæ ·å¼ --- */
  html, body { height:100%; margin:0; padding:0; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; background:#f4f4f4; color: #333; }
  #fakePage { min-height:100vh; max-width:800px; margin:0 auto; padding:30px 20px; text-align:center; background:#ffffff; box-sizing:border-box; position:relative; z-index:10; }
  #fakePage h1 { font-size:48px; margin:0; color:#ff4d4d; font-weight:bold; }
  #fakePage h2 { font-size:24px; margin:16px 0; color:#444; }
  #fakePage p { font-size:16px; margin:8px 0; opacity:0.9; }
  .section { margin:20px 0; text-align:left; }
  .link { color:#0066ff; text-decoration:underline; cursor:pointer; }
  .footer { position:absolute; bottom:10px; left:50%; transform:translateX(-50%); font-size:12px; color:#666; text-align:center; width:90%; }
  .feedback-trigger { position:fixed; bottom:20px; right:20px; color:#0066ff; cursor:pointer; font-size:13px; z-index:20; text-decoration:underline; opacity:0.8; }

  /* --- 2. æ­£å¼é¡µé¢å¸ƒå±€ä¸èƒŒæ™¯ä¿®å¤ --- */
  #realContent { 
    display:none; position:fixed; inset:0; z-index:100;
    /* è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„ä¿åº•èƒŒæ™¯å›¾ï¼Œé˜²æ­¢åŠ è½½å¤±è´¥æ˜¾ç¤ºçº¯è‰² */
    background-image: url('https://pic4.zhimg.com/v2-825555431664188b2207904e57193d93_r.jpg');
    background-size: cover; background-position: center; background-repeat: no-repeat;
    color:#fff; flex-direction:column; align-items:center; 
    padding-top: 15vh; text-align: center;
  }
  /* åŠ æ·±èƒŒæ™¯é®ç½©ï¼Œç¡®ä¿æ–‡å­—æ¸…æ™° */
  #realContent::before { content: ""; position: absolute; inset: 0; background: rgba(0, 0, 0, 0.55); z-index: -1; }

  /* --- 3. ä¸‹é›ªç‰¹æ•ˆç”»å¸ƒ --- */
  #canvas { position: fixed; inset: 0; z-index: 101; pointer-events: none; display: none; }

  /* æ­£å¼é¡µå†…å®¹æ ·å¼ (å±‚çº§è¦é«˜äºé›ªèŠ±) */
  .content-layer { position: relative; z-index: 102; width: 100%; display: flex; flex-direction: column; align-items: center; height: 100%; }
  .main-title { 
    font-size:2.4rem; font-weight:800; background: linear-gradient(90deg,#00f0ff,#a855f7); 
    -webkit-background-clip:text; color:transparent; margin-bottom: 50px;
    text-shadow: 0 4px 12px rgba(0,0,0,0.6);
  }
  .btn-group { display: flex; flex-direction: column; gap: 20px; width: 85%; max-width: 280px; }
  .copy-btn { 
    padding:16px; background:linear-gradient(90deg,#00f0ff,#a855f7); 
    border:none; border-radius:15px; font-size:17px; cursor:pointer; 
    color:#000; font-weight:bold; box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  }
  /* ä½¿ç”¨ flex å¸ƒå±€å°†å…¬å‘Šæ¨åˆ°åº•éƒ¨ä¸­é—´ */
  .spacer { flex-grow: 1; }
  #notice { margin-bottom: 12vh; color: #a5f3fc; font-size: 14px; letter-spacing: 1px; padding: 0 20px; }

  /* å›¾æ ‡æ§åˆ¶æ  */
  #topControls { display:none; position:fixed; top:20px; right:20px; z-index:200; gap: 20px; align-items: center; }
  .icon-btn { font-size:26px; cursor:pointer; opacity:0.7; color:#fff; transition: 0.3s; }
  @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  .music-playing { animation: rotate 3s linear infinite; opacity: 1; text-shadow: 0 0 10px #00f0ff; }

  /* å¼¹çª—æ ·å¼ */
  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); backdrop-filter: blur(5px); align-items:center; justify-content:center; z-index:1000; }
  .modal-content { background:#fff; padding:30px 20px; border-radius:20px; width:88%; max-width:320px; text-align:center; position:relative; color:#333; }
  .close-x { position:absolute; top:12px; right:18px; font-size:30px; color:#ccc; cursor:pointer; line-height:1; }
  input { width:100%; padding:14px; margin:12px 0; border:1px solid #eee; border-radius:10px; box-sizing:border-box; font-size: 16px; }
  .primary-btn { width:100%; padding:14px; background:#0051c3; color:#fff; border:none; border-radius:10px; cursor:pointer; font-weight: bold; }
  .settings-list { list-style:none; padding:0; margin:20px 0; }
  .settings-list li { padding:14px; background:#f8f9fa; margin-bottom:10px; border-radius:12px; cursor:pointer; display:flex; justify-content:space-between; border: 1px solid #eee; }
</style>
</head>
<body>

<audio id="bgMusic" loop preload="auto"></audio>
<canvas id="canvas"></canvas>

<div id="fakePage">
  <h1>Error 1101</h1>
  <h2>Worker threw exception</h2>
  <p>Ray ID: <span id="ray-id"></span> â€¢ <span id="ts-id"></span></p>
  <div class="section">
    <h3>What happened?</h3>
    <p>You've requested a page on a website that is on the Cloudflare network. An unknown error occurred while rendering the page.</p>
  </div>
  <div class="section">
    <h3>What can I do?</h3>
    <p>If you are the owner of this website: refer to <a class="link" onclick="openModal('userLoginModal')">Workers Logs</a>.</p>
  </div>
  <div class="footer">Performance & security by Cloudflare</div>
</div>
<div class="feedback-trigger" onclick="openModal('userLoginModal')">é”™è¯¯åé¦ˆ</div>

<div id="topControls">
  <div id="musicBtn" class="icon-btn" onclick="toggleMusic()">ğŸµ</div>
  <div id="adminGear" class="icon-btn" onclick="openAdminPortal()">âš™ï¸</div>
</div>

<div id="realContent">
  <div class="content-layer">
    <div id="mainTitle" class="main-title">XUEçš„è®¢é˜…åˆ†äº«</div>
    <div class="btn-group">
      <button class="copy-btn" onclick="copyLink(1)">å¤åˆ¶è®¢é˜…é“¾æ¥ 1</button>
      <button class="copy-btn" onclick="copyLink(2)">å¤åˆ¶è®¢é˜…é“¾æ¥ 2</button>
    </div>
    <div class="spacer"></div>
    <p id="notice"></p>
  </div>
</div>

<div id="userLoginModal" class="modal">
  <div class="modal-content">
    <span class="close-x" onclick="closeModal('userLoginModal')">&times;</span>
    <h3>èº«ä»½éªŒè¯</h3>
    <input id="userPwdInput" type="password" placeholder="è¯·è¾“å…¥è®¿é—®ä»£ç ">
    <button class="primary-btn" onclick="doUserLogin()">è¿›å…¥</button>
  </div>
</div>

<div id="adminVerifyModal" class="modal">
  <div class="modal-content">
    <span class="close-x" onclick="closeModal('adminVerifyModal')">&times;</span>
    <h3>ç®¡ç†å‘˜è®¤è¯</h3>
    <input id="adminPwdLogin" type="password" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
    <button class="primary-btn" onclick="verifyAdmin()">è§£é”</button>
  </div>
</div>

<div id="adminMenuModal" class="modal">
  <div class="modal-content">
    <span class="close-x" onclick="closeModal('adminMenuModal')">&times;</span>
    <h3>è®¾ç½®èœå•</h3>
    <ul class="settings-list">
      <li onclick="prepEdit('titleText', 'æ ‡é¢˜æ–‡å­—')">æ ‡é¢˜æ–‡å­— â”</li>
      <li onclick="prepEdit('sub1', 'é“¾æ¥ 1')">è®¢é˜…é“¾æ¥ 1 â”</li>
      <li onclick="prepEdit('sub2', 'é“¾æ¥ 2')">è®¢é˜…é“¾æ¥ 2 â”</li>
      <li onclick="prepEdit('notice', 'å…¬å‘Šè¯´æ˜')">å…¬å‘Šè¯´æ˜ â”</li>
      <li onclick="prepEdit('bgUrl', 'èƒŒæ™¯å›¾URL')">èƒŒæ™¯å›¾URL â”</li>
      <li onclick="prepEdit('musicUrl', 'æ­Œå•è®¾ç½®')">èƒŒæ™¯éŸ³ä¹ â”</li>
      <li onclick="prepEdit('userPassword', 'è®¿é—®å¯†ç ')">è®¿é—®å¯†ç  â”</li>
    </ul>
  </div>
</div>

<div id="editModal" class="modal">
  <div class="modal-content">
    <span class="close-x" onclick="closeModal('editModal')">&times;</span>
    <h3 id="editLabel">ä¿®æ”¹</h3>
    <input id="editInput" type="text">
    <button class="primary-btn" onclick="submitEdit()">ä¿å­˜</button>
  </div>
</div>

<script>
let SETTINGS = {};
let adminSessionPw = "";
let editingKey = "";
let playlist = [];
let currentTrackIndex = 0;
const audio = document.getElementById('bgMusic');

// ä¼ªè£…æ•°æ®åˆå§‹åŒ–
document.getElementById('ray-id').innerText = Math.random().toString(16).slice(2, 14);
document.getElementById('ts-id').innerText = new Date().toISOString().slice(0,19).replace('T',' ');

async function load() {
  try {
    const r = await fetch("/api/get-links?" + Date.now());
    SETTINGS = await r.json();
    document.getElementById('mainTitle').innerText = SETTINGS.titleText || "XUEçš„è®¢é˜…åˆ†äº«";
    document.getElementById('notice').innerText = SETTINGS.notice || "";
    
    // èƒŒæ™¯å›¾ä¿®å¤é€»è¾‘ï¼šå¦‚æœæœ‰è®¾ç½®åˆ™ä½¿ç”¨è®¾ç½®ï¼Œå¦åˆ™ä½¿ç”¨CSSé‡Œçš„é»˜è®¤ä¿åº•å›¾
    if(SETTINGS.bgUrl) {
        document.getElementById('realContent').style.backgroundImage = `url('${SETTINGS.bgUrl}')`;
    }
    
    // æ­Œå•åˆå§‹åŒ–
    let mUrl = SETTINGS.musicUrl || "https://music.163.com/song/media/outer/url?id=186001.mp3";
    playlist = mUrl.split(/[,ï¼Œ;ï¼›\s]+/).filter(url => url.trim() !== "");
    if(playlist.length > 0) {
      currentTrackIndex = 0;
      audio.src = playlist[currentTrackIndex];
    }
  } catch(e) {}
}
load();

function openModal(id) { document.getElementById(id).style.display = 'flex'; }
function closeModal(id) { document.getElementById(id).style.display = 'none'; }

// éªŒè¯ç™»å½•ï¼šæˆåŠŸåå¼€å¯ä¸€åˆ‡
function doUserLogin() {
  if(document.getElementById('userPwdInput').value === SETTINGS.userPassword) {
    document.getElementById('fakePage').style.display = 'none';
    document.querySelector('.feedback-trigger').style.display = 'none';
    document.getElementById('realContent').style.display = 'flex';
    document.getElementById('topControls').style.display = 'flex';
    
    // ä¿®å¤ç‰¹æ•ˆå’ŒéŸ³ä¹
    document.getElementById('canvas').style.display = 'block'; 
    initParticles(); 
    audio.play().then(() => {
      document.getElementById('musicBtn').classList.add('music-playing');
    }).catch(()=>{});
    
    closeModal('userLoginModal');
  } else { alert("å¯†ç é”™è¯¯"); }
}

function toggleMusic() {
  if (audio.paused) { audio.play(); document.getElementById('musicBtn').classList.add('music-playing'); }
  else { currentTrackIndex = (currentTrackIndex + 1) % playlist.length; audio.src = playlist[currentTrackIndex]; audio.play(); }
}

function openAdminPortal() { adminSessionPw ? openModal('adminMenuModal') : openModal('adminVerifyModal'); }
function verifyAdmin() { adminSessionPw = document.getElementById('adminPwdLogin').value; if(adminSessionPw) { closeModal('adminVerifyModal'); openModal('adminMenuModal'); } }

// ä¿®å¤ä¸‹é›ªç‰¹æ•ˆ JS
function initParticles() {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  let width = canvas.width = window.innerWidth;
  let height = canvas.height = window.innerHeight;
  const particles = [];
  for(let i=0; i<60; i++) particles.push({ x: Math.random()*width, y: Math.random()*height, r: Math.random()*2+1, s: Math.random()*1+0.5 });
  function draw() {
    ctx.clearRect(0,0,width,height);
    ctx.fillStyle = "rgba(255,255,255,0.6)";
    particles.forEach(p => {
      ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
      p.y += p.s; if(p.y > height) p.y = -5;
    });
    requestAnimationFrame(draw);
  }
  draw();
  window.onresize = () => { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; };
}

function prepEdit(key, label) { editingKey = key; document.getElementById('editLabel').innerText = "ä¿®æ”¹ " + label; document.getElementById('editInput').value = SETTINGS[key] || ""; closeModal('adminMenuModal'); openModal('editModal'); }
async function submitEdit() {
  try {
    const res = await fetch("/api/update-links", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ password: adminSessionPw, [editingKey]: document.getElementById('editInput').value }) });
    if((await res.json()).success) location.reload(); else { alert("éªŒè¯å¤±è´¥"); adminSessionPw=""; closeModal('editModal'); }
  } catch(e) { alert("ç½‘ç»œé”™è¯¯"); }
}
function copyLink(n) { navigator.clipboard.writeText((n===1?SETTINGS.sub1:SETTINGS.sub2)|| "").then(() => alert("å·²å¤åˆ¶")); }
</script>
</body>
</html>
