<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Error 1101</title>
<style>
  /* --- 1. ä¼ªè£…é¡µ (ç»å¯¹ä¸åŠ¨) --- */
  body, html { margin:0; padding:0; font-family: "Segoe UI", Roboto, sans-serif; background:#fff; color:#000; height: 100%; overflow: hidden; }
  #fakePage { padding: 40px 20px; max-width: 800px; margin: 0 auto; display: block; }
  .error-title { font-size: 48px; font-weight: 400; color: #404040; margin: 0; }
  .ray-id-row { font-size: 14px; color: #999; margin: 15px 0 30px; font-family: monospace; }
  .status-text { font-size: 28px; color: #404040; margin-bottom: 40px; }
  .section-title { font-size: 28px; color: #404040; margin: 40px 0 15px; }
  .section-p { font-size: 16px; color: #404040; margin-bottom: 15px; line-height: 1.5; }
  .cf-link { color: #0051c3; text-decoration: none; cursor: pointer; }
  .hr { border: 0; border-top: 1px solid #d9d9d9; margin: 40px 0 20px; }
  .footer-row { font-size: 13px; color: #666; }

  /* --- 2. æ­£å¼é¡µé¢ (èƒŒæ™¯ä¸å¸ƒå±€ä¼˜åŒ–) --- */
  #realContent { 
    display:none; position:fixed; inset:0; z-index:100;
    /* ä¿åº•èƒŒæ™¯ï¼šæ·±è‰²æ¸å˜ */
    background: linear-gradient(135deg, #1a1c2c 0%, #4a192c 100%);
    background-size: cover; background-position: center;
    color:#fff; flex-direction:column; align-items:center; 
    padding-top: 12vh; text-align: center;
  }
  /* åŠé€æ˜é®ç½©ï¼Œå¢åŠ æ–‡å­—æ¸…æ™°åº¦ */
  #realContent::after { content: ""; position: absolute; inset: 0; background: rgba(0, 0, 0, 0.4); z-index: -1; }

  .main-title { 
    font-size:2.4rem; font-weight:800; background: linear-gradient(90deg,#00f0ff,#a855f7); 
    -webkit-background-clip:text; color:transparent; margin-bottom: 40px;
    text-shadow: 0 4px 15px rgba(0,0,0,0.6);
  }
  .btn-group { display: flex; flex-direction: column; gap: 22px; width: 85%; max-width: 280px; z-index: 101; }
  .copy-btn { 
    padding:16px; background:linear-gradient(90deg,#00f0ff,#a855f7); 
    border:none; border-radius:18px; font-size:17px; cursor:pointer; 
    color:#000; font-weight:bold; box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  }
  
  /* å ä½ç¬¦ï¼šç”¨äºå°†å…¬å‘Šæ¨å‘ä¸‹æ–¹æ­£ä¸­å¿ƒ */
  .spacer { flex-grow: 1; }
  #notice { 
    margin-bottom: 10vh; /* è·ç¦»åº•éƒ¨çš„è·ç¦» */
    color: #a5f3fc; font-size: 15px; letter-spacing: 2px; font-weight: 300;
    z-index: 101;
  }

  /* --- 3. å›¾æ ‡æ ·å¼ --- */
  #topControls { display:none; position:fixed; top:25px; right:20px; z-index:201; gap: 20px; }
  .icon-btn { font-size:26px; cursor:pointer; opacity:0.7; color:#fff; transition: 0.3s; }
  @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  .music-playing { animation: rotate 4s linear infinite; opacity: 1; text-shadow: 0 0 10px #00f0ff; }

  /* --- 4. å¼¹çª—æ ·å¼ --- */
  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); backdrop-filter: blur(8px); align-items:center; justify-content:center; z-index:1000; }
  .modal-content { background:#fff; padding:30px 20px; border-radius:24px; width:88%; max-width:320px; text-align:center; color:#333; position:relative; }
  .close-x { position:absolute; top:15px; right:20px; font-size:28px; color:#ccc; cursor:pointer; }
  input { width:100%; padding:14px; margin:15px 0; border:1px solid #eee; border-radius:12px; box-sizing:border-box; font-size:16px; text-align:center; }
  .primary-btn { width:100%; padding:14px; background:#0051c3; color:#fff; border:none; border-radius:12px; cursor:pointer; font-weight: bold; }
  
  #canvas { position: fixed; inset: 0; z-index: 50; pointer-events: none; display: none; }
</style>
</head>
<body>

<audio id="bgMusic" loop preload="auto"></audio>
<canvas id="canvas"></canvas>

<div id="fakePage">
  <h1 class="error-title">Error 1101</h1>
  <p class="ray-id-row">Ray ID: <span id="ray-id"></span> &bull; <span id="ts-id"></span></p>
  <h2 class="status-text">Worker threw exception</h2>
  <h3 class="section-title">What happened?</h3>
  <p class="section-p">You've requested a page on a website (<span class="domain-info"></span>) that is on the Cloudflare network.</p>
  <h3 class="section-title">What can I do?</h3>
  <p class="section-p"><strong>If you are the owner of this website:</strong><br>
  refer to <span class="cf-link" onclick="openModal('userLoginModal')">Workers - Errors and Exceptions</span> and check Workers Logs.</p>
  <hr class="hr">
  <div class="footer-row">Cloudflare Ray ID: <strong id="ray-id-ft"></strong><br>Performance & security by Cloudflare</div>
</div>

<div id="topControls">
  <div id="musicBtn" class="icon-btn" onclick="toggleMusic()">ğŸµ</div>
  <div id="adminGear" class="icon-btn" onclick="openAdmin()">âš™ï¸</div>
</div>

<div id="realContent">
  <div id="mainTitle" class="main-title">XUEçš„è®¢é˜…åˆ†äº«</div>
  <div class="btn-group">
    <button class="copy-btn" onclick="copyLink(1)">å¤åˆ¶è®¢é˜…é“¾æ¥ 1</button>
    <button class="copy-btn" onclick="copyLink(2)">å¤åˆ¶è®¢é˜…é“¾æ¥ 2</button>
  </div>
  <div class="spacer"></div> <p id="notice"></p>
</div>

<div id="userLoginModal" class="modal">
  <div class="modal-content">
    <span class="close-x" onclick="closeModal('userLoginModal')">&times;</span>
    <h3 style="margin-top:0">Debug Access</h3>
    <input id="userPwdInput" type="password" placeholder="Authorization Code">
    <button class="primary-btn" onclick="doUserLogin()">Verify</button>
  </div>
</div>

<div id="adminVerifyModal" class="modal">
  <div class="modal-content">
    <span class="close-x" onclick="closeModal('adminVerifyModal')">&times;</span>
    <h3>Admin Auth</h3>
    <input id="adminPwdLogin" type="password" placeholder="Password">
    <button class="primary-btn" onclick="verifyAdmin()">Unlock</button>
  </div>
</div>

<script>
let SETTINGS = {};
let adminPw = "";
const audio = document.getElementById('bgMusic');

// åˆå§‹åŒ–ä¼ªè£…æ•°æ®
document.getElementById('ray-id').innerText = Math.random().toString(16).slice(2, 14);
document.getElementById('ray-id-ft').innerText = document.getElementById('ray-id').innerText;
document.getElementById('ts-id').innerText = new Date().toISOString().replace('T',' ').slice(0,19) + ' UTC';
document.querySelectorAll('.domain-info').forEach(e => e.innerText = window.location.hostname);

async function load() {
  try {
    const r = await fetch("/api/get-links?" + Date.now());
    SETTINGS = await r.json();
    document.getElementById('mainTitle').innerText = SETTINGS.titleText || "XUEçš„è®¢é˜…åˆ†äº«";
    document.getElementById('notice').innerText = SETTINGS.notice || "é©¬åˆ°æˆåŠŸ";
    
    // èƒŒæ™¯å›¾ä¿®å¤ï¼šæä¾›ä¸€ä¸ªç»å¯¹å¯é çš„é»˜è®¤å›¾
    const bg = SETTINGS.bgUrl || "https://pic1.zhimg.com/v2-540c66048d0a202ec94c7766b1a20800_r.jpg";
    document.getElementById('realContent').style.backgroundImage = `url('${bg}')`;
    
    // éŸ³ä¹åˆå§‹åŒ–
    audio.src = SETTINGS.musicUrl || "https://music.163.com/song/media/outer/url?id=186001.mp3";
  } catch(e) {}
}
load();

function openModal(id) { document.getElementById(id).style.display = 'flex'; }
function closeModal(id) { document.getElementById(id).style.display = 'none'; }

function doUserLogin() {
  if(document.getElementById('userPwdInput').value === SETTINGS.userPassword) {
    document.getElementById('fakePage').style.display = 'none';
    document.getElementById('realContent').style.display = 'flex';
    document.getElementById('topControls').style.display = 'flex';
    closeModal('userLoginModal');
    // æ¿€æ´»éŸ³ä¹
    audio.play().then(() => {
      document.getElementById('musicBtn').classList.add('music-playing');
    }).catch(() => {});
  } else { alert("Error"); }
}

function toggleMusic() {
  if (audio.paused) { audio.play(); document.getElementById('musicBtn').classList.add('music-playing'); }
  else { audio.pause(); document.getElementById('musicBtn').classList.remove('music-playing'); }
}

function openAdmin() {
  if (adminPw) alert("Already Unlocked. Please use management functions."); // è¿™é‡Œå¯ä»¥è·³è½¬èœå•
  else openModal('adminVerifyModal');
}

function verifyAdmin() {
  adminPw = document.getElementById('adminPwdLogin').value;
  closeModal('adminVerifyModal');
  alert("Admin mode activated (Placeholder)");
}

function copyLink(n) {
  const url = n === 1 ? SETTINGS.sub1 : SETTINGS.sub2;
  navigator.clipboard.writeText(url).then(() => alert("Copied!"));
}
</script>
</body>
</html>
