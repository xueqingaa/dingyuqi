<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Error 1101</title>
<style>
  body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; background:#000; color:#fff; margin:0; padding:0; line-height:1.5; min-height:100vh; position:relative; }
  .container { max-width:800px; margin:0 auto; padding:40px 20px 140px; text-align:center; }
  h1 { font-size:36px; margin:0; color:#ff6b6b; }
  h2 { font-size:20px; margin:12px 0; }
  p { font-size:14px; margin:6px 0; opacity:0.85; }
  .section { margin:20px 0; }
  .link { color:#00d1ff; text-decoration:underline; cursor:pointer; }
  .footer { position:fixed; bottom:70px; left:50%; transform:translateX(-50%); font-size:11px; opacity:0.6; text-align:center; width:90%; line-height:1.3; }
  .feedback-btn { position:fixed; bottom:20px; right:30px; padding:4px 12px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.2); color:#aaa; border-radius:4px; cursor:pointer; font-size:12px; z-index:10; opacity:0.7; transition:all 0.3s; }
  .feedback-btn:hover { color:#00d1ff; opacity:1; background:rgba(0,209,255,0.1); border-color:#00d1ff; }
  #modal, #adminModal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); align-items:center; justify-content:center; z-index:1000; }
  .modal-content { background:#111; padding:20px; border-radius:16px; width:90%; max-width:320px; text-align:center; position:relative; box-shadow:0 0 30px rgba(0,209,255,0.2); }
  .close-btn { position:absolute; top:8px; right:12px; background:none; border:none; color:#888; font-size:28px; line-height:1; cursor:pointer; opacity:0.7; }
  .close-btn:hover { color:#fff; opacity:1; }
  input { width:100%; padding:10px; margin:10px 0; border-radius:6px; border:none; font-size:15px; background:#222; color:#fff; }
  button { width:100%; padding:10px; background:#00d1ff; color:#000; border:none; border-radius:6px; font-size:15px; cursor:pointer; margin-top:10px; }
  #realContent { display:none; position:fixed; inset:0; background:linear-gradient(135deg,#0f0c29,#302b63,#24243e); color:#e0f7ff; flex-direction:column; align-items:center; justify-content:center; padding:20px; text-align:center; }
  .admin-btn { position:fixed; top:16px; right:16px; background:none; border:none; color:#aaa; font-size:26px; cursor:pointer; z-index:50; opacity:0.8; }
  .admin-btn:hover { color:#00d1ff; }
  .header { margin-bottom:2rem; display:flex; align-items:center; justify-content:center; flex-wrap:wrap; }
  .snowflake { font-size:1.8rem; margin:0 8px; vertical-align:middle; opacity:0.9; }
  .main-title { font-size:2.2rem; font-weight:700; letter-spacing:2px; background:linear-gradient(90deg,#00f0ff,#a855f7); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 0 15px rgba(168,85,247,0.5); margin:0.5rem 0; }
  .copy-btn { margin:12px 0; padding:12px 36px; background:linear-gradient(90deg,#00f0ff,#a855f7); border:none; border-radius:50px; font-size:15px; cursor:pointer; color:#000; min-width:220px; box-shadow:0 4px 15px rgba(0,240,255,0.3); transition:all 0.3s; }
  .copy-btn:hover { transform:translateY(-2px); box-shadow:0 8px 25px rgba(0,240,255,0.5); }
  .tip { color:#a5f3fc; opacity:0; transition:opacity 0.4s; margin-top:0.8rem; font-size:0.9rem; }
  .notice { margin-top:2.5rem; opacity:0.9; font-size:1rem; }
</style>
</head>
<body>

<div class="container">
  <h1>Error 1101</h1>
  <h2>Worker threw exception</h2>
  <p>Ray ID: 126a014fe66b3b9b • 2026-01-17 20:36:xx</p>
  <div class="section">
    <h3>What happened?</h3>
    <p>You've requested a page on a website that is on the Cloudflare network. An unknown error occurred while rendering the page.</p>
  </div>
  <div class="section">
    <h3>What can I do?</h3>
    <p>If you are the owner of this website: refer to <a href="https://developers.cloudflare.com/workers/observability/errors/" class="link">Workers - Errors and Exceptions</a> and check Workers Logs.</p>
  </div>
  <div class="footer">Performance & security by Cloudflare</div>
</div>

<button class="feedback-btn" onclick="document.getElementById('modal').style.display='flex'">错误反馈</button>

<!-- 普通反馈弹窗 -->
<div id="modal">
  <div class="modal-content">
    <button class="close-btn" onclick="document.getElementById('modal').style.display='none'">&times;</button>
    <h3>请提交您的反馈意见</h3>
    <input id="pw" type="password" placeholder="描述您遇到的问题">
    <button onclick="checkPassword()">提交</button>
  </div>
</div>

<!-- 管理员面板 -->
<div id="adminModal">
  <div class="modal-content">
    <button class="close-btn" onclick="document.getElementById('adminModal').style.display='none'">&times;</button>
    <h3>管理员 - 修改链接</h3>
    <input id="adminPw" type="password" placeholder="管理员密码">
    <input id="newSub1" placeholder="订阅链接 1 (完整URL)">
    <input id="newSub2" placeholder="订阅链接 2 (完整URL，可选)">
    <button onclick="saveLinks()">保存</button>
  </div>
</div>

<!-- 真实内容 -->
<div id="realContent">
  <div class="header">
    <span class="snowflake">❄️</span>
    <span class="main-title">XUE CF代理</span>
    <span class="snowflake">❄️</span>
  </div>
  <button class="copy-btn" onclick="copyLink(1)">复制订阅链接 1</button>
  <button class="copy-btn" onclick="copyLink(2)">复制订阅链接 2</button>
  <p id="tip" class="tip"></p>
  <p class="notice">马到成功</p>
  <button class="admin-btn" onclick="document.getElementById('adminModal').style.display='flex'">⚙️</button>
</div>

<script>
let SUB_LINKS = { sub1: "123", sub2: "456" };

// 加载链接
fetch("/api/get-links")
  .then(r => r.json())
  .then(data => {
    SUB_LINKS.sub1 = data.sub1 || SUB_LINKS.sub1;
    SUB_LINKS.sub2 = data.sub2 || SUB_LINKS.sub2;
  })
  .catch(() => {});

// 普通密码（从环境变量读取，部署后生效）
let USER_PASSWORD = "88888888"; // 开发默认值，部署后被变量覆盖

// 如果你加了 get-user-password API，可用下面代码读取（更安全）
// fetch("/api/get-user-password")
//   .then(r => r.json())
//   .then(data => { if (data.password) USER_PASSWORD = data.password; })
//   .catch(() => {});

function checkPassword() {
  const input = document.getElementById('pw').value.trim();
  if (input === USER_PASSWORD) {
    document.getElementById('modal').style.display = 'none';
    document.getElementById('realContent').style.display = 'flex';
    document.querySelector('.feedback-btn').style.display = 'none';
  } else {
    alert("您的意见已经发送，请等待系统处理！");
    document.getElementById('modal').style.display = 'none';
  }
}

function copyLink(type) {
  const link = type === 1 ? SUB_LINKS.sub1 : SUB_LINKS.sub2;
  if (!link.trim()) return alert("链接未配置");
  navigator.clipboard.writeText(link);
  document.getElementById('tip').textContent = "已复制到剪贴板";
  document.getElementById('tip').style.opacity = 1;
  setTimeout(() => document.getElementById('tip').style.opacity = 0, 2000);
}

async function saveLinks() {
  const pw = document.getElementById('adminPw').value.trim();
  const sub1 = document.getElementById('newSub1').value.trim();
  const sub2 = document.getElementById('newSub2').value.trim();

  if (!pw) return alert("请输入管理员密码");

  const res = await fetch("/api/update-links", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ password: pw, sub1, sub2 })
  });

  const data = await res.json();
  if (data.success) {
    alert("链接已更新！");
    document.getElementById('adminModal').style.display = 'none';
    location.reload();
  } else {
    alert("管理员密码错误或更新失败");
  }
}
</script>
</body>
</html>