<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Error 1101</title>
<style>
  /* --- 1. ä¼ªè£…é¡µæ ·å¼ (ä¸¥æ ¼åŸç‰ˆ) --- */
  body, html { margin:0; padding:0; font-family: "Segoe UI", Roboto, sans-serif; background:#fff; color:#000; height: 100%; overflow: hidden; }
  #fakePage { padding: 40px 20px; max-width: 800px; margin: 0 auto; display: block; }
  .error-title { font-size: 48px; font-weight: 400; color: #404040; margin: 0; }
  .ray-id-row { font-size: 14px; color: #999; margin: 15px 0 30px; font-family: monospace; }
  .cf-link { color: #0051c3; text-decoration: none; cursor: pointer; }
  .hr { border: 0; border-top: 1px solid #d9d9d9; margin: 40px 0 20px; }

  /* --- 2. æ­£å¼ä¸»é¡µå¸ƒå±€ (æ·±åº¦ä¼˜åŒ–) --- */
  #realContent { 
    display:none; position:fixed; inset:0; z-index:100;
    background: #1a1a1a; /* é»˜è®¤æ·±è‰²åº•ï¼Œé˜²æ­¢èƒŒæ™¯å›¾æŒ‚æ‰ */
    background-size: cover; background-position: center; background-repeat: no-repeat;
    color:#fff; flex-direction:column; align-items:center; 
    padding: 8vh 0 5vh; /* é¡¶éƒ¨é¢„ç•™8%é«˜åº¦ï¼Œåº•éƒ¨é¢„ç•™5% */
    text-align: center;
    box-sizing: border-box;
  }
  #realContent::before { content: ""; position: absolute; inset: 0; background: rgba(0, 0, 0, 0.4); z-index: -1; }

  /* æ ‡é¢˜ä¸Šç§» */
  .main-title { 
    font-size:2.2rem; font-weight:800; background: linear-gradient(90deg,#00f0ff,#a855f7); 
    -webkit-background-clip:text; color:transparent; 
    margin: 0 0 40px; /* æ ‡é¢˜ä¸‹è¾¹è· */
    text-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }

  /* æŒ‰é’®ç»„ */
  .btn-group { display: flex; flex-direction: column; gap: 18px; width: 85%; max-width: 280px; }
  .copy-btn { 
    padding:16px; background:linear-gradient(90deg,#00f0ff,#a855f7); 
    border:none; border-radius:15px; font-size:16px; cursor:pointer; 
    color:#000; font-weight:bold; transition: 0.2s;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  }

  /* è¯´æ˜æ–‡å­—ä¸‹ç§»ï¼šåˆ©ç”¨ margin-top: auto æ²‰åº• */
  #notice { 
    margin-top: auto; 
    color:#a5f3fc; font-size:15px; opacity: 0.9; 
    letter-spacing: 2px;
  }

  /* å›¾æ ‡æ§åˆ¶ (æ­£å¼é¡µæ‰æ˜¾ç¤º) */
  .top-controls { display:none; position:fixed; top:20px; right:20px; z-index:201; gap: 15px; }
  .icon-btn { font-size:24px; cursor:pointer; color:#fff; opacity:0.7; }
  @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  .music-playing { animation: rotate 4s linear infinite; opacity: 1; }

  /* ç²’å­å±‚ */
  #canvas { position: fixed; inset: 0; z-index: 50; pointer-events: none; display: none; }

  /* å¼¹çª— */
  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); backdrop-filter: blur(5px); align-items:center; justify-content:center; z-index:1000; }
  .modal-content { background:#fff; padding:30px 20px; border-radius:20px; width:85%; max-width:320px; text-align:center; color:#333; }
  input { width:100%; padding:14px; margin:15px 0; border:1px solid #ddd; border-radius:10px; box-sizing:border-box; font-size:16px; }
  .primary-btn { width:100%; padding:14px; background:#0051c3; color:#fff; border:none; border-radius:10px; cursor:pointer; font-weight:bold; }
</style>
</head>
<body>

<audio id="bgMusic" loop preload="auto"></audio>
<canvas id="canvas"></canvas>

<div id="fakePage">
  <h1 class="error-title">Error 1101</h1>
  <p class="ray-id-row">Ray ID: <span id="rid1"></span> &bull; <span id="ts"></span></p>
  <h2 class="status-text">Worker threw exception</h2>
  <h3 style="font-size:28px; color:#404040; margin:40px 0 15px;">What happened?</h3>
  <p style="font-size:16px; color:#404040;">You've requested a page on a website (<span class="domain"></span>) that is on the Cloudflare network.</p>
  <p style="font-size:16px; color:#404040;">refer to <span class="cf-link" onclick="openModal('userLoginModal')">Workers - Errors and Exceptions</span>.</p>
  <hr class="hr">
  <div style="font-size:13px; color:#666;">Cloudflare Ray ID: <strong id="rid2"></strong><br>Performance & security by Cloudflare</div>
</div>

<div id="topControls" class="top-controls">
  <div id="musicBtn" class="icon-btn" onclick="toggleMusic()">ğŸµ</div>
  <div id="adminGear" class="icon-btn" onclick="handleGearClick()">âš™ï¸</div>
</div>

<div id="realContent">
  <div id="mainTitle" class="main-title">XUEçš„è®¢é˜…åˆ†äº«</div>
  <div class="btn-group">
    <button class="copy-btn" onclick="copyLink(1)">å¤åˆ¶è®¢é˜…é“¾æ¥ 1</button>
    <button class="copy-btn" onclick="copyLink(2)">å¤åˆ¶è®¢é˜…é“¾æ¥ 2</button>
  </div>
  <p id="notice">é©¬åˆ°æˆåŠŸ</p>
</div>

<div id="userLoginModal" class="modal">
  <div class="modal-content">
    <h3>Debug Access</h3>
    <input id="userPwdInput" type="password" placeholder="Access Code">
    <button class="primary-btn" onclick="doUserLogin()">Verify</button>
  </div>
</div>

<script>
let SETTINGS = {};
let playlist = [];
let currentIdx = 0;
const audio = document.getElementById('bgMusic');

// 1. åŸºç¡€æ•°æ®åˆå§‹åŒ–
const ray = Math.random().toString(16).slice(2,14);
document.getElementById('rid1').innerText = ray;
document.getElementById('rid2').innerText = ray;
document.getElementById('ts').innerText = new Date().toISOString().replace('T',' ').slice(0,19) + ' UTC';
document.querySelectorAll('.domain').forEach(e => e.innerText = window.location.hostname);

// 2. åŠ è½½é…ç½®
async function load() {
  try {
    const r = await fetch("/api/get-links?" + Date.now());
    SETTINGS = await r.json();
    if(SETTINGS.titleText) document.getElementById('mainTitle').innerText = SETTINGS.titleText;
    if(SETTINGS.notice) document.getElementById('notice').innerText = SETTINGS.notice;
    
    // èƒŒæ™¯å›¾é€»è¾‘ï¼šå¦‚æœåå°æ²¡è®¾ç½®ï¼Œç»™ä¸€ä¸ªé»˜è®¤çš„å‘¨æ°ä¼¦å£çº¸
    const bg = SETTINGS.bgUrl || "https://pic4.zhimg.com/v2-825555431664188b2207904e57193d93_r.jpg";
    document.getElementById('realContent').style.backgroundImage = `url(${bg})`;

    // æ­Œå•é€»è¾‘ (è’²å…¬è‹±çš„çº¦å®šé«˜æ½®ç‰ˆ)
    const mUrl = SETTINGS.musicUrl || "https://music.163.com/song/media/outer/url?id=186001.mp3";
    playlist = mUrl.split(/[,ï¼Œ;ï¼›\s]+/).filter(u => u.trim() !== "");
    audio.src = playlist[0];
  } catch(e) {}
}
load();

// 3. ç™»å½•ä¸éŸ³ä¹è§¦å‘
function doUserLogin() {
  if(document.getElementById('userPwdInput').value === SETTINGS.userPassword) {
    document.getElementById('fakePage').style.display = 'none';
    document.getElementById('realContent').style.display = 'flex';
    document.getElementById('topControls').style.display = 'flex';
    document.getElementById('canvas').style.display = 'block';
    
    // å…³é”®ï¼šç‚¹å‡»éªŒè¯æŒ‰é’®æ—¶å¿…é¡»ç«‹åˆ»è°ƒç”¨ play()
    audio.play().then(() => {
      document.getElementById('musicBtn').classList.add('music-playing');
    }).catch(err => console.log("Autoplay blocked:", err));
    
    initParticles();
    closeModal('userLoginModal');
  } else {
    alert("Code Incorrect");
  }
}

function toggleMusic() {
  if(audio.paused) {
    audio.play();
    document.getElementById('musicBtn').classList.add('music-playing');
  } else {
    // æ­£åœ¨æ’­æ”¾æ—¶ç‚¹å‡»åˆ‡æ­Œ
    currentIdx = (currentIdx + 1) % playlist.length;
    audio.src = playlist[currentIdx];
    audio.play();
  }
}

// ç²’å­ç‰¹æ•ˆ
function initParticles() {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  let particles = [];
  for(let i=0; i<60; i++) {
    particles.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*2+1, v:Math.random()*1+0.5});
  }
  function move() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "rgba(255,255,255,0.4)";
    ctx.beginPath();
    particles.forEach(p => {
      ctx.moveTo(p.x, p.y);
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      p.y += p.v;
      if(p.y > canvas.height) p.y = -10;
    });
    ctx.fill();
    requestAnimationFrame(move);
  }
  move();
}

// è¾…åŠ©å‡½æ•°
function openModal(id) { document.getElementById(id).style.display = 'flex'; }
function closeModal(id) { document.getElementById(id).style.display = 'none'; }
function copyLink(n) {
  const url = n === 1 ? SETTINGS.sub1 : SETTINGS.sub2;
  navigator.clipboard.writeText(url).then(() => alert("Copied!"));
}
// ç®¡ç†å‘˜éªŒè¯é€»è¾‘(verifyAdmin, handleGearClickç­‰)è¯·ä¿ç•™ä¹‹å‰çš„...
</script>
</body>
</html>
